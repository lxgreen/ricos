import{transform,isEqualWith,isObject as isObject$1,cloneDeep,isEqual,omit,pick,sortBy,isEmpty}from"lodash";import _extends from"@babel/runtime/helpers/extends";var isobject$1=function(val){return null!=val&&"object"==typeof val&&!1===Array.isArray(val)};function isObjectObject(o){return!0===isobject$1(o)&&"[object Object]"===Object.prototype.toString.call(o)}var toString$1={}.toString,isarray=Array.isArray||function(arr){return"[object Array]"==toString$1.call(arr)},hasValues=function(o,noZero){if(null==o)return!1;if("boolean"==typeof o)return!0;if("number"==typeof o)return 0!==o||!0!==noZero;if(void 0!==o.length)return 0!==o.length;for(var key in o)if(o.hasOwnProperty(key))return!0;return!1};function toString(val){return val?Array.isArray(val)?val.join("."):val:""}var hasValue=function(obj,prop,noZero){return null!=(val=obj)&&"object"==typeof val&&!1===isarray(val)?hasValues(function(obj,prop,a,b,c){if(null===(val=obj)||"object"!=typeof val&&"function"!=typeof val||!prop)return obj;var val;if(prop=toString(prop),a&&(prop+="."+toString(a)),b&&(prop+="."+toString(b)),c&&(prop+="."+toString(c)),prop in obj)return obj[prop];for(var segs=prop.split("."),len=segs.length,i=-1;obj&&++i<len;){for(var key=segs[i];"\\"===key[key.length-1];)key=key.slice(0,-1)+"."+segs[++i];obj=obj[key]}return obj}(obj,prop),noZero):hasValues(obj,prop);var val},unsetValue=function(obj,prop){if(!isobject$1(obj))throw new TypeError("expected an object.");if(obj.hasOwnProperty(prop))return delete obj[prop],!0;if(hasValue(obj,prop)){for(var segs=prop.split("."),last=segs.pop();segs.length&&"\\"===segs[segs.length-1].slice(-1);)last=segs.pop().slice(0,-1)+"."+last;for(;segs.length;)obj=obj[prop=segs.shift()];return delete obj[last]}return!0},omitDeep=function omitDeep(value,keys){if(void 0===value)return{};if(Array.isArray(value)){for(var i=0;i<value.length;i++)value[i]=omitDeep(value[i],keys);return value}if(!1===isObjectObject(o=value)||"function"!=typeof(ctor=o.constructor)||!1===isObjectObject(prot=ctor.prototype)||!1===prot.hasOwnProperty("isPrototypeOf"))return value;var o,ctor,prot;if("string"==typeof keys&&(keys=[keys]),!Array.isArray(keys))return value;for(var j=0;j<keys.length;j++)unsetValue(value,keys[j]);for(var key in value)value.hasOwnProperty(key)&&(value[key]=omitDeep(value[key],keys));return value};var IGNORED_KEYS=["updatedTimestamp","createdTimestamp","tempData","isCustomVideo","VERSION"],IGNORED_POLL_CONFIG_KEYS=["alignment","size","width"],IGNORED_SRC_KEYS=["id","original_file_name"],IGNORED_BUTTON_DESIGN_KEYS=["activeButton","padding"],OEMBED_KEYS=["thumbnail_url","width","height"];function compare(object,base,options){void 0===options&&(options={});var _options=options,verbose=_options.verbose,ignoredKeys=_options.ignoredKeys,allIgnoredKeys=[].concat(IGNORED_KEYS,ignoredKeys||[]),objectWithoutIgnored=omitDeep(cloneDeep(object),allIgnoredKeys),basetWithoutIgnored=omitDeep(cloneDeep(base),allIgnoredKeys);return objectWithoutIgnored.blocks&&removeEmoji(objectWithoutIgnored),basetWithoutIgnored.blocks&&removeEmoji(basetWithoutIgnored),function changes(object,base){return transform(object,(function(result,value,key){var baseValue=base[key];if(!isEqualWith(value,baseValue,comparator)){var _console$dir,currentValue=isObject$1(value)&&isObject$1(baseValue)?changes(value,baseValue):value;if(result[key]=currentValue,verbose&&(!isObject$1(currentValue)||0===Object.keys(currentValue).length))console.dir(((_console$dir={})[key]={from:baseValue,to:value},_console$dir),{depth:null})}}))}(objectWithoutIgnored,basetWithoutIgnored)}var comparator=function(left,right,key){return void 0!==(null==left?void 0:left.enableVoteRole)||void 0!==(null==right?void 0:right.enableVoteRole)?isEqual(omit(left,IGNORED_POLL_CONFIG_KEYS),omit(right,IGNORED_POLL_CONFIG_KEYS)):null!=left&&left.thumbnail_url||null!=right&&right.thumbnail_url?isEqual(pick(left,OEMBED_KEYS),pick(right,OEMBED_KEYS)):"src"===key?isEqual(omit(left,IGNORED_SRC_KEYS),omit(right,IGNORED_SRC_KEYS)):"design"===key?isEqual(omit(left,IGNORED_BUTTON_DESIGN_KEYS),omit(right,IGNORED_BUTTON_DESIGN_KEYS)):"link"!==key||"noopener"!==(null==right?void 0:right.rel)&&"noopener"!==(null==left?void 0:left.rel)?void 0:isEqual(omit(left,["rel"]),omit(right,["rel"]))},removeEmoji=function(object){var iterable,emojiEntityKeys=[];Object.entries(object.entityMap).forEach((function(_ref){var key=_ref[0];return"EMOJI_TYPE"===_ref[1].type&&emojiEntityKeys.push(parseInt(key,10))})),object.entityMap=(iterable=Object.entries(object.entityMap).filter((function(_ref2){return"EMOJI_TYPE"!==_ref2[1].type})),[].concat(iterable).reduce((function(obj,_ref){var key=_ref[0],val=_ref[1];return obj[key]=val,obj}),{})),object.blocks=object.blocks.map((function(block){return _extends({},block,{entityRanges:block.entityRanges.filter((function(range){return!emojiEntityKeys.includes(range.key)}))})}))};function areRangesEqual(blockRanges1,blockRanges2,sortKey){return blockRanges1.length===blockRanges2.length&&isEqual(sortBy(blockRanges1,(function(r){return r[sortKey]})),sortBy(blockRanges2,(function(r){return r[sortKey]})))}function areBlocksEqual(currentStateBlocks,initialStateBlocks){return currentStateBlocks.length===initialStateBlocks.length&&currentStateBlocks.every((function(block,i){return block1=block,block2=initialStateBlocks[i],block1.text===block2.text&&block1.depth===block2.depth&&block1.type===block2.type&&areRangesEqual(block1.inlineStyleRanges,block2.inlineStyleRanges,"style")&&areRangesEqual(block1.entityRanges,block2.entityRanges,"key")&&function(block1,block2){return(!block1.data.textAlignment||"left"===block1.data.textAlignment)==(!block2.data.textAlignment||"left"===block2.data.textAlignment)||block1.data.textAlignment===block2.data.textAlignment}(block1,block2)&&isEmpty(compare(block1.data,block2.data,{verbose:!1,ignoredKeys:["textAlignment"]}));var block1,block2}))}function isContentEqual(currContent,initialContent){var blocksEqual=areBlocksEqual(currContent.blocks,initialContent.blocks),entitiesEqual=isEmpty(compare(currContent.entityMap,initialContent.entityMap,{verbose:!1}));return blocksEqual&&entitiesEqual}export{isContentEqual};
