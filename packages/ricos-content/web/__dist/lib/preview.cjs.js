"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var lodash=require("lodash");function _interopDefaultLegacy(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var _extends__default=_interopDefaultLegacy(require("@babel/runtime/helpers/extends")),toVersion=function(versionString){return versionString.split(".").map((function(literal){var numeric=parseInt(literal,10);return lodash.isNaN(numeric)?0:numeric})).slice(0,3)},compareVersions=function(left,right){var leftVersion=toVersion(left),rightVersion=toVersion(right);return leftVersion.map((function(left,idx){return Math.sign(left-rightVersion[idx])})).find((function(num){return 0!==num}))||0},evaluations={"<":function(left,right){return compareVersions(left,right)<0},">":function(left,right){return compareVersions(left,right)>0},"=":function(left,right){return 0===compareVersions(left,right)},"<=":function(left,right){return compareVersions(left,right)<=0},">=":function(left,right){return compareVersions(left,right)>=0}},Version={lessThan:function(left,right){return compareVersions(left,right)<0},greaterThan:function(left,right){return compareVersions(left,right)>0},equal:function(left,right){return 0===compareVersions(left,right)},compare:compareVersions,currentVersion:"8.63.7",evaluate:function(tested,semver){var _$exec=/([<>=]{0,2})(.*)/gm.exec(semver),operator=_$exec[1],version=_$exec[2];return evaluations[operator||"="](tested,version)}},METHOD_BLOCK_MAP=Object.freeze({h1:"header-one",h2:"header-two",h3:"header-three",h4:"header-four",h5:"header-five",h6:"header-six",quote:"blockquote"}),METHOD_GROUPED_BLOCK_MAP=Object.freeze({plain:"unstyled",code:"code-block",ol:"ordered-list-item",ul:"unordered-list-item"}),METHOD_PLUGIN_DATA_MAP=Object.freeze({image:{type:"wix-draft-plugin-image",mutability:"IMMUTABLE",data:{config:{alignment:"center",size:"content",showTitle:!1,showDescription:!1}}},video:{type:"wix-draft-plugin-video",mutability:"IMMUTABLE",data:{config:{size:"content",alignment:"center"}}},gallery:{type:"wix-draft-plugin-gallery",mutability:"IMMUTABLE",data:{config:{alignment:"center",size:"content",layout:"small",spacing:0},styles:{galleryLayout:2,gallerySizeType:"px",gallerySizePx:300,galleryMargin:0,oneRow:!1,cubeRatio:1,galleryThumbnailsAlignment:"bottom",isVertical:!0,numberOfImagesPerRow:3,imageMargin:20,thumbnailSpacings:0,cubeType:"fill",enableInfiniteScroll:!0,titlePlacement:"SHOW_ON_HOVER",allowHover:!1,itemClick:"link",fullscreen:!1,showArrows:!1,gridStyle:1,loveButton:!1,allowSocial:!1,allowDownload:!1,mobileSwipeAnimation:"NO_EFFECT",thumbnailSize:120,gotStyleParams:!0,cubeImages:!0,groupSize:1,groupTypes:"1",hasThumbnails:!1,enableScroll:!0,isGrid:!0,isSlider:!1,isColumns:!1,isSlideshow:!1,cropOnlyFill:!1,smartCrop:!1,imageResize:!1,galleryImageRatio:2,galleryType:"Columns",minItemSize:50,videoPlay:"auto"}}},soundCloud:{type:"wix-draft-plugin-sound-cloud",mutability:"IMMUTABLE",data:{config:{size:"content",alignment:"center"}}},giphy:{type:"wix-draft-plugin-giphy",mutability:"IMMUTABLE",data:{config:{size:"content",alignment:"center"}}},map:{type:"wix-draft-plugin-map",mutability:"IMMUTABLE",data:{config:{size:"content",alignment:"center",width:400,height:400}}},file:{type:"wix-draft-plugin-file-upload",mutability:"IMMUTABLE",data:{config:{alignment:"left",size:"small"}}},divider:{type:"wix-draft-plugin-divider",mutability:"IMMUTABLE",data:{type:"single",config:{size:"large",alignment:"center",textWrap:"nowrap"}}},link:{type:"LINK",mutability:"IMMUTABLE",data:{config:{}}},linkPreview:{type:"wix-draft-plugin-link-preview",mutability:"IMMUTABLE",data:{config:{size:"content",alignment:"center"}}}}),INTERACTIONS=Object.freeze({READ_MORE:"READ_MORE",IMAGE_COUNTER:"IMAGE_COUNTER",SEE_FULL_CONTENT:"SEE_FULL_CONTENT"}),getPoster=function(item){var _item$url$thumbnail,_item$thumbnail,_item$url$thumbnail2,_item$thumbnail2,_item$url$thumbnail3,_item$thumbnail3;return{url:(null===(_item$url$thumbnail=item.url.thumbnail)||void 0===_item$url$thumbnail?void 0:_item$url$thumbnail.pathname)||(null===(_item$thumbnail=item.thumbnail)||void 0===_item$thumbnail?void 0:_item$thumbnail.pathname)||item.thumbnail_url||item.thumbnail,width:(null===(_item$url$thumbnail2=item.url.thumbnail)||void 0===_item$url$thumbnail2?void 0:_item$url$thumbnail2.width)||(null===(_item$thumbnail2=item.thumbnail)||void 0===_item$thumbnail2?void 0:_item$thumbnail2.width)||item.thumbnail_width||item.width,height:(null===(_item$url$thumbnail3=item.url.thumbnail)||void 0===_item$url$thumbnail3?void 0:_item$url$thumbnail3.height)||(null===(_item$thumbnail3=item.thumbnail)||void 0===_item$thumbnail3?void 0:_item$thumbnail3.height)||item.thumbnail_height||item.height}},galleryTypeConverters={giphy:function(item){var _item$width=item.width,width=void 0===_item$width?600:_item$width,_item$height=item.height,height=void 0===_item$height?480:_item$height;return{mediaUrl:item.mp4,metadata:{type:"video",videoUrl:item.mp4,videoId:item.url,poster:{url:item.url,width:width,height:height},source:"giphy",width:width,height:height}}},video:function(item){var _item$url,isCustom=item.isCustom,_ref=isCustom?item.url:item,_ref$width=_ref.width,width=void 0===_ref$width?600:_ref$width,_ref$height=_ref.height,height=void 0===_ref$height?480:_ref$height,url=isCustom?null===(_item$url=item.url)||void 0===_item$url?void 0:_item$url.pathname:item.url;return{url:url,mediaUrl:url,metadata:{type:"video",poster:getPoster(item),videoId:url,width:width,height:height}}},image:function(item){return{itemId:item.id||item.url,metadata:{width:item.width,height:item.height}}}},toGalleryItems=function(items){return items.map((function(item,index){return _extends__default.default({itemId:item.id||"item-"+index,url:item.url},galleryTypeConverters[item.type](item))}))},defaultMerger=function(mediaInfo,entity){return _extends__default.default({},entity,{data:_extends__default.default({},entity.data,mediaInfo)})},videoMerger=function(_ref2,entity){var url=_ref2.url,isCustom=_ref2.isCustom;return _extends__default.default({},entity,{data:_extends__default.default({},entity.data,{src:url,isCustomVideo:!!isCustom})})},mergers={"wix-draft-plugin-image":function(_ref,entity){var url=_ref.url,width=_ref.width,height=_ref.height,_ref$alt=_ref.alt,alt=void 0===_ref$alt?"":_ref$alt,_ref$caption=_ref.caption,caption=void 0===_ref$caption?"":_ref$caption,link=_ref.link,_ref$source=_ref.source,source=void 0===_ref$source?null:_ref$source;return _extends__default.default({},entity,{data:_extends__default.default({},entity.data,{config:_extends__default.default({},entity.data.config,link?{link:link}:{}),metadata:{alt:alt,caption:caption},src:_extends__default.default({width:width,height:height},"static"===source?{url:url,source:source}:{file_name:url})})})},"wix-draft-plugin-gallery":function(items,entity){return _extends__default.default({},entity,{data:_extends__default.default({},entity.data,{items:toGalleryItems(items)})})},"wix-draft-plugin-giphy":function(_ref3,entity){var width=_ref3.width,height=_ref3.height,url=_ref3.url,thumbnail=_ref3.thumbnail;return _extends__default.default({},entity,{data:_extends__default.default({},entity.data,{gif:{width:width,height:height,originalUrl:url,stillUrl:thumbnail}})})},"wix-draft-plugin-video":videoMerger,"wix-draft-plugin-sound-cloud":videoMerger,"wix-draft-plugin-file-upload":function(_ref4,entity){var fileType=_ref4.fileType,name=_ref4.name,url=_ref4.url;return _extends__default.default({},entity,{data:_extends__default.default({},entity.data,{type:fileType,name:name,url:url})})},"wix-draft-plugin-map":function(mapSettings,entity){return _extends__default.default({},entity,{data:_extends__default.default({},entity.data,{mapSettings:mapSettings})})},"wix-draft-plugin-divider":defaultMerger,mention:defaultMerger,LINK:defaultMerger,"wix-draft-plugin-link-preview":function(_ref5,entity){var url=_ref5.url;return _extends__default.default({},entity,{data:_extends__default.default({},entity.data,{config:_extends__default.default({},entity.data.config,{link:_extends__default.default({},entity.data.config.link,{url:url})})})})},"wix-draft-plugin-headers-markdown":defaultMerger,"wix-draft-plugin-link-button":defaultMerger,"wix-draft-plugin-action-button":defaultMerger,"wix-draft-plugin-poll":defaultMerger,"wix-draft-plugin-html":defaultMerger},DEFAULT_BLOCK_CONFIG={data:{},inlineStyleRanges:[],entityRanges:[],depth:0},createBlock=function(type,text,config){return _extends__default.default({key:Math.random().toString(36).substr(2,5),type:type,text:text},_extends__default.default({},DEFAULT_BLOCK_CONFIG,config||{}))},addEntity=function(_ref2){var _extends2,mediaInfo,entity,contentState=_ref2.contentState,data=_ref2.data,config=_ref2.config,mergedEntity=(mediaInfo=data,mergers[(entity=config).type](mediaInfo,entity));return _extends__default.default({},contentState,{entityMap:_extends__default.default({},contentState.entityMap,(_extends2={},_extends2[Object.keys(contentState.entityMap).length]=mergedEntity,_extends2))})},addPlugin=function(_ref3){var contentState=_ref3.contentState,data=_ref3.data,config=_ref3.config,contentStateWithBlock=function(_ref){var contentState=_ref.contentState,text=_ref.text,type=_ref.type,config=_ref.config;return _extends__default.default({},contentState,{blocks:[].concat(contentState.blocks,[createBlock(type,text,config)])})}({contentState:contentState,text:" ",type:"atomic",config:{entityRanges:[{offset:0,length:1,key:Object.keys(contentState.entityMap).length}]}});return addEntity({contentState:contentStateWithBlock,data:data,config:config})},interactionDataMerger=function(_ref){var contentState=_ref.contentState,_ref$settings=_ref.settings,settings=void 0===_ref$settings?{}:_ref$settings,_ref$blockFilter=_ref.blockFilter,blockFilter=void 0===_ref$blockFilter?function(){}:_ref$blockFilter,type=_ref.type,_ref$schema=_ref.schema,schema=void 0===_ref$schema?[]:_ref$schema;if(!contentState.blocks||0===contentState.blocks.length)return contentState;var lastBlock=contentState.blocks.slice(-1)[0];if(blockFilter(lastBlock))return contentState;var invalidSettings=Object.keys(settings).filter((function(key){return!schema.includes(key)}));if(invalidSettings.length>0&&console.error("Warning: invalid "+type+" interaction settings found",invalidSettings),"atomic"!==lastBlock.type){var _lastBlock$data,modifiedBlock=_extends__default.default({},lastBlock,{data:_extends__default.default({},lastBlock.data,{interactions:[].concat((null==lastBlock||null===(_lastBlock$data=lastBlock.data)||void 0===_lastBlock$data?void 0:_lastBlock$data.interactions)||[],[{type:type,settings:settings}])})});return _extends__default.default({},contentState,{blocks:[].concat(contentState.blocks.slice(0,contentState.blocks.length-1),[modifiedBlock])})}var lastBlockEntityKey=lastBlock.entityRanges.length>0&&lastBlock.entityRanges[0].key;if(!1!==lastBlockEntityKey){var _extends2,lastBlockEntity=contentState.entityMap[lastBlockEntityKey],modifiedEntity=_extends__default.default({},lastBlockEntity,{data:_extends__default.default({},lastBlockEntity&&lastBlockEntity.data,{interactions:[].concat(lastBlockEntity&&lastBlockEntity.data.interactions||[],[{type:type,settings:settings}])})});return _extends__default.default({},contentState,{entityMap:_extends__default.default({},contentState.entityMap,(_extends2={},_extends2[lastBlockEntityKey]=modifiedEntity,_extends2))})}return contentState},DEFAULT_STATE={blocks:[],entityMap:{},VERSION:Version.currentVersion},ContentStateBuilder=function(){function ContentStateBuilder(initialState){this.contentState=_extends__default.default({},DEFAULT_STATE,initialState||{})}return ContentStateBuilder.prototype.get=function(){return this.contentState},ContentStateBuilder}();Object.keys(_extends__default.default({},METHOD_BLOCK_MAP,METHOD_GROUPED_BLOCK_MAP)).forEach((function(method){ContentStateBuilder.prototype[method]=function(textBlocksWithEntities){var content,textContentArray=(content=textBlocksWithEntities,lodash.isArray(content)?content:[content]);return this.contentState=textContentArray.reduce((function(state,_ref){return function(_ref4){var contentState=_ref4.contentState,block=_ref4.block,entities=_ref4.entities;return _extends__default.default({},contentState,{blocks:[].concat(contentState.blocks,[block]),entityMap:_extends__default.default({},contentState.entityMap,entities)})}({contentState:state,block:_ref.block,entities:_ref.entities})}),this.contentState),this}})),Object.entries(METHOD_PLUGIN_DATA_MAP).forEach((function(_ref2){var method=_ref2[0],defaultEntityData=_ref2[1];ContentStateBuilder.prototype[method]=function(_ref3){var mediaInfo=_ref3.mediaInfo,_ref3$config=_ref3.config,config=void 0===_ref3$config?{}:_ref3$config,_ref3$overrides=_ref3.overrides,overrides=void 0===_ref3$overrides?{}:_ref3$overrides;return this.contentState=addPlugin({contentState:this.contentState,data:mediaInfo,config:_extends__default.default({},defaultEntityData,{data:_extends__default.default({},defaultEntityData.data,{config:_extends__default.default({},defaultEntityData.data.config,config)},overrides)})}),this}})),Object.entries({readMore:function(builder,settings){return void 0===settings&&(settings={}),builder.contentState=interactionDataMerger({contentState:builder.contentState,settings:settings,blockFilter:function(block){return"atomic"===block.type},type:INTERACTIONS.READ_MORE,schema:["label","onClick","expandMode","lines","text","showToggle"]}),builder},seeFullPost:function(builder,settings){return void 0===settings&&(settings={}),builder.contentState=interactionDataMerger({contentState:builder.contentState,settings:settings,blockFilter:function(){return!1},type:INTERACTIONS.SEE_FULL_CONTENT,schema:["label","labelStyles","overlayStyles","onClick"]}),builder},imageCounter:function(builder,settings){return void 0===settings&&(settings={}),builder.contentState=interactionDataMerger({contentState:builder.contentState,settings:settings,blockFilter:function(block){return"atomic"!==block.type},type:INTERACTIONS.IMAGE_COUNTER,schema:["counter","formatLabel","onClick","style"]}),builder}}).forEach((function(_ref4){var key=_ref4[0],method=_ref4[1];ContentStateBuilder.prototype[key]=function(settings){return method(this,settings)}}));var defaultEntityConverter=function(){return[]},videoConverter=function(_ref3){var _src$thumbnail,_ref3$data=_ref3.data,_ref3$data$src=_ref3$data.src,src=void 0===_ref3$data$src?{}:_ref3$data$src,isCustomVideo=_ref3$data.isCustomVideo,_ref3$data$metadata=_ref3$data.metadata,metadata=void 0===_ref3$data$metadata?{}:_ref3$data$metadata;return[{type:"video",url:lodash.isString(src)?src:src.pathname,isCustom:isCustomVideo,thumbnail:lodash.has(src,"thumbnail")?null===(_src$thumbnail=src.thumbnail)||void 0===_src$thumbnail?void 0:_src$thumbnail.pathname:metadata.thumbnail_url||"",caption:metadata.title||""}]},linkConverter=function(entity){return[{type:"link",url:entity.data.url}]},converters={"wix-draft-plugin-image":function(entity){var _entity$data$src,_entity$data$src2,_entity$data$src3,_entity$data$metadata,_entity$data$metadata2,_entity$data$config;return[{width:null===(_entity$data$src=entity.data.src)||void 0===_entity$data$src?void 0:_entity$data$src.width,height:null===(_entity$data$src2=entity.data.src)||void 0===_entity$data$src2?void 0:_entity$data$src2.height,url:null===(_entity$data$src3=entity.data.src)||void 0===_entity$data$src3?void 0:_entity$data$src3.file_name,type:"image",alt:(null===(_entity$data$metadata=entity.data.metadata)||void 0===_entity$data$metadata?void 0:_entity$data$metadata.alt)||"",caption:(null===(_entity$data$metadata2=entity.data.metadata)||void 0===_entity$data$metadata2?void 0:_entity$data$metadata2.caption)||"",link:null===(_entity$data$config=entity.data.config)||void 0===_entity$data$config?void 0:_entity$data$config.link}]},"wix-draft-plugin-gallery":function(entity){return entity.data.items.filter((function(_ref){var metadata=_ref.metadata;return!(null!=metadata&&metadata.type)||"image"===(null==metadata?void 0:metadata.type)||"video"===(null==metadata?void 0:metadata.type)})).map((function(_ref2){var _metadata$poster,metadata=_ref2.metadata,url=_ref2.url,itemId=_ref2.itemId;return"video"===(null==metadata?void 0:metadata.type)?{type:"video",url:url,thumbnail:(null==metadata||null===(_metadata$poster=metadata.poster)||void 0===_metadata$poster?void 0:_metadata$poster.url)||"",caption:(null==metadata?void 0:metadata.title)||"",isGalleryItem:!0}:{url:url,height:null==metadata?void 0:metadata.height,width:null==metadata?void 0:metadata.width,id:itemId,type:"image",alt:(null==metadata?void 0:metadata.altText)||"",caption:(null==metadata?void 0:metadata.title)||"",isGalleryItem:!0}}))},"wix-draft-plugin-divider":defaultEntityConverter,"wix-draft-plugin-video":videoConverter,"wix-draft-plugin-sound-cloud":videoConverter,"wix-draft-plugin-giphy":function(entity){var _entity$data$gif,_entity$data$gif2,_entity$data$gif3,_entity$data$gif4,_entity$data$gif5;return[{type:"giphy",url:null===(_entity$data$gif=entity.data.gif)||void 0===_entity$data$gif?void 0:_entity$data$gif.originalUrl,mp4:null===(_entity$data$gif2=entity.data.gif)||void 0===_entity$data$gif2?void 0:_entity$data$gif2.downsizedSmallMp4,thumbnail:null===(_entity$data$gif3=entity.data.gif)||void 0===_entity$data$gif3?void 0:_entity$data$gif3.stillUrl,width:null===(_entity$data$gif4=entity.data.gif)||void 0===_entity$data$gif4?void 0:_entity$data$gif4.width,height:null===(_entity$data$gif5=entity.data.gif)||void 0===_entity$data$gif5?void 0:_entity$data$gif5.height,source:"static"}]},"wix-draft-plugin-file-upload":function(entity){return[{name:entity.data.name,type:"file",fileType:entity.data.type,url:entity.data.url}]},"wix-draft-plugin-map":function(entity){return[{type:"map",mapSettings:entity.data.mapSettings}]},mention:defaultEntityConverter,"wix-draft-plugin-headers-markdown":defaultEntityConverter,"wix-draft-plugin-link-button":defaultEntityConverter,"wix-draft-plugin-action-button":defaultEntityConverter,"wix-draft-plugin-poll":defaultEntityConverter,LINK:linkConverter,LINK_PREVIEW:linkConverter,"wix-draft-plugin-html":defaultEntityConverter},extractTextBlocksWithEntities=function(_ref,blockFilter){var blocks=_ref.blocks,entityMap=_ref.entityMap;return blocks.filter(blockFilter).reduce((function(texts,block){var entities=block.entityRanges.reduce((function(map,range){return map["_"+range.key]=entityMap[range.key],map}),{}),_block=_extends__default.default({},block,{entityRanges:block.entityRanges.map((function(range){return _extends__default.default({},range,{key:"_"+range.key})}))});return[].concat(texts,[{block:_block,entities:entities}])}),[])},extractTextBlockArray=function(raw,blockTypeFilter){return extractTextBlocksWithEntities(raw,(function(_ref2){var type=_ref2.type,text=_ref2.text;return blockTypeFilter(type)&&text.length>0}))},createTextFragments=function(raw){return(_ref3=raw,blockTypeFilter=function(type){return"atomic"!==type},blocks=_ref3.blocks,entityMap=_ref3.entityMap,current=0,next=0,batches=lodash.groupBy(blocks,(function(block){var isValid=blockTypeFilter(block.type);return isValid?current===next&&next++:current<next&&current++,isValid&&current})),Object.entries(batches).filter((function(value){return"false"!==value[0]})).map((function(batch){return extractTextBlocksWithEntities({blocks:batch[1],entityMap:entityMap},(function(_ref4){var type=_ref4.type,text=_ref4.text;return blockTypeFilter(type)&&text.length>0}))})).filter((function(batch){return batch.length>0}))).filter((function(batch){return batch.length})).map((function(batch){var textCombined=batch.map((function(entry){return entry.block.text})).join("\n"),copyBlocks=lodash.cloneDeep(batch),offset=0;copyBlocks.forEach((function(entry){entry.block.inlineStyleRanges.map((function(style){return style.offset+=offset})),entry.block.entityRanges.map((function(entity){return entity.offset+=offset})),offset+=entry.block.text.length+"\n".length}));var inlineStyleRanges=copyBlocks.flatMap((function(entry){return entry.block.inlineStyleRanges})),entityRanges=copyBlocks.flatMap((function(entry){return entry.block.entityRanges})),entities=copyBlocks.map((function(block){return block.entities})).reduce((function(acc,curr){return _extends__default.default({},acc,curr)}));return lodash.merge(lodash.cloneDeep(batch[0]),{block:{text:textCombined,inlineStyleRanges:inlineStyleRanges,entityRanges:entityRanges},entities:entities})}));var _ref3,blockTypeFilter,blocks,entityMap,current,next,batches},extractMedia=function(_ref6){var entityMap=_ref6.entityMap;return Object.values(entityMap).filter((function(entity){var _ref7$config=(entity.data||{}).config,config=void 0===_ref7$config?{}:_ref7$config;return!("spoiler"in config)||!config.spoiler.enabled})).reduce((function(media,entity){return[].concat(media,function(entity){return converters[entity.type]?converters[entity.type](entity):[]}(entity))}),[])},getContentStateMetadata=function(raw){var entityMap,mediaEntities=extractMedia(raw),galleryItems=mediaEntities.filter((function(_ref9){return _ref9.isGalleryItem})),singleMediaItems=mediaEntities.filter((function(_ref10){var type=_ref10.type,isGalleryItem=_ref10.isGalleryItem;return function(type){return type&&["image","video","giphy"].includes(type)}(type)&&!isGalleryItem})),media={singleMediaItems:singleMediaItems,galleryItems:galleryItems,totalCount:galleryItems.length+singleMediaItems.length},blocks=Object.entries(METHOD_BLOCK_MAP).reduce((function(prev,_ref11){var _extends2,func=_ref11[0],blockType=_ref11[1];return _extends__default.default({},prev,((_extends2={})[func]=extractTextBlockArray(raw,(function(type){return type===blockType})),_extends2))}),{}),groupedBlocks=Object.entries(METHOD_GROUPED_BLOCK_MAP).reduce((function(prev,_ref12){var _extends3,func=_ref12[0],blockType=_ref12[1];return _extends__default.default({},prev,((_extends3={})[func]=function(_ref5,blockType){return _ref5.blocks.reduce((function(result,block,idx){if(block.type===blockType){var list=-1===result.lastItemIndex?[].concat(result.list,[[]]):result.list;return list[list.length-1]=[].concat(list[list.length-1],[block]),{list:list,lastItemIndex:idx}}return{list:result.list,lastItemIndex:-1}}),{list:[],lastItemIndex:-1}).list.filter((function(arr){return arr.length>0}))}(raw,blockType).map((function(blocks){return extractTextBlockArray({blocks:blocks,entityMap:raw.entityMap},(function(type){return type===blockType}))})).filter((function(arr){return arr.length>0})),_extends3))}),{}),nonMediaPluginsCount=(entityMap=raw.entityMap,Object.values(entityMap).length-media.totalCount),nonSeparatorPlugins=mediaEntities.filter((function(_ref13){var type=_ref13.type;return["link","hashtag","mention"].includes(type)}));return _extends__default.default({allText:extractTextBlockArray(raw,(function(type){return"atomic"!==type})),textFragments:createTextFragments(raw),media:media,images:mediaEntities.filter((function(_ref14){return"image"===_ref14.type})),videos:mediaEntities.filter((function(_ref15){return"video"===_ref15.type})),files:mediaEntities.filter((function(_ref16){return"file"===_ref16.type})),maps:mediaEntities.filter((function(_ref17){return"map"===_ref17.type})),links:mediaEntities.filter((function(_ref18){return"link"===_ref18.type})),nonMediaPluginsCount:nonMediaPluginsCount,collapsablePluginsCount:nonMediaPluginsCount-nonSeparatorPlugins.length},blocks,groupedBlocks)},ContentStateTransformation=function(){function ContentStateTransformation(_ref){var _if=_ref._if,_then=_ref._then,initialPreviewState=_ref.initialPreviewState;this.rules=[],this.rule({_if:_if,_then:_then}),this.previewState=initialPreviewState}var _proto=ContentStateTransformation.prototype;return _proto.rule=function(_ref2){var _if=_ref2._if,_then=_ref2._then;if(!lodash.isFunction(_if)||!lodash.isFunction(_then))throw new TypeError("invalid rule added: `_if` and `_then` should be functions ");return this.rules.push({_if:_if,_then:_then}),this},_proto.apply=function(contentState){var previewStateBuilder=new ContentStateBuilder(this.previewState),metadata=getContentStateMetadata(contentState);return this.rules.reduce((function(builder,rule){return rule._if(metadata)?rule._then(metadata,builder):builder}),previewStateBuilder).get()},_proto.toObject=function(){return this.rules.map((function(rule){return{_if:rule._if.toString(),_then:rule._then.toString()}}))},ContentStateTransformation}();exports.ContentStateTransformation=ContentStateTransformation,exports.INTERACTIONS=INTERACTIONS;
