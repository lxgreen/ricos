import _objectWithoutPropertiesLoose from"@babel/runtime/helpers/objectWithoutPropertiesLoose";import _extends from"@babel/runtime/helpers/extends";import{v4}from"uuid";import{merge}from"lodash";var toUpperCase=function(s){return s.toUpperCase()},seenKeys={},MULTIPLIER=Math.pow(2,24);function generateId(){for(var key;void 0===key||seenKeys.hasOwnProperty(key)||!isNaN(Number(key));)key=Math.floor(Math.random()*MULTIPLIER).toString(32);return seenKeys[key]=!0,key}var _excluded=["type"],createNode=function(type,_ref){var nodes=_ref.nodes,data=_ref.data,style=_ref.style,id=_ref.id;return _extends({type:type,id:null!=id?id:generateId(),nodes:nodes},dataByNodeType(type,data),{style:style})},dataByNodeType=function(type,data){var _CODE_BLOCK$DIVIDER$H;return(_CODE_BLOCK$DIVIDER$H={},_CODE_BLOCK$DIVIDER$H.CODE_BLOCK={codeBlockData:data},_CODE_BLOCK$DIVIDER$H.DIVIDER={dividerData:data},_CODE_BLOCK$DIVIDER$H.HEADING={headingData:data},_CODE_BLOCK$DIVIDER$H.FILE={fileData:data},_CODE_BLOCK$DIVIDER$H.GALLERY={galleryData:data},_CODE_BLOCK$DIVIDER$H.GIF={gifData:data},_CODE_BLOCK$DIVIDER$H.HTML={htmlData:data},_CODE_BLOCK$DIVIDER$H.IMAGE={imageData:data},_CODE_BLOCK$DIVIDER$H.BUTTON={buttonData:data},_CODE_BLOCK$DIVIDER$H.LINK_PREVIEW={LinkPreviewData:data},_CODE_BLOCK$DIVIDER$H.MAP={mapData:data},_CODE_BLOCK$DIVIDER$H.PARAGRAPH={paragraphData:data},_CODE_BLOCK$DIVIDER$H.POLL={pollData:data},_CODE_BLOCK$DIVIDER$H.TEXT={textData:data},_CODE_BLOCK$DIVIDER$H.VIDEO={videoData:data},_CODE_BLOCK$DIVIDER$H.APP_EMBED={appEmbedData:data},_CODE_BLOCK$DIVIDER$H.LINK_PREVIEW={linkPreviewData:data},_CODE_BLOCK$DIVIDER$H.TABLE={tableData:data},_CODE_BLOCK$DIVIDER$H.TABLE_CELL={tableCellData:data},_CODE_BLOCK$DIVIDER$H.COLLAPSIBLE_LIST={collapsibleListData:data},_CODE_BLOCK$DIVIDER$H)[type]},createParagraphNode=function(nodes,data,style){return void 0===nodes&&(nodes=[]),createNode("PARAGRAPH",{nodes:nodes,data:_extends({textStyle:{textAlignment:"AUTO"}},data),style:style})},createTextNode=function(text,decorations){return void 0===decorations&&(decorations=[]),createNode("TEXT",{nodes:[],id:"",data:{text:text,decorations:decorations}})},createHeadingNode=function(nodes,data){return void 0===nodes&&(nodes=[]),createNode("HEADING",{nodes:nodes,data:_extends({textStyle:{textAlignment:"AUTO"}},data)})},createDecoration=function(type,data){return void 0===data&&(data={}),_extends({type:type},data)},initializeMetadata=function(_temp){var _ref2=void 0===_temp?{}:_temp,version=_ref2.version,_ref2$id=_ref2.id,id=void 0===_ref2$id?v4():_ref2$id,createdTimestamp=_ref2.createdTimestamp,updatedTimestamp=_ref2.updatedTimestamp;return{version:version||1,createdTimestamp:createdTimestamp||new Date,updatedTimestamp:updatedTimestamp||new Date,id:id}},reduceDecorations=function(decorations){var reducedDecorationsMap=decorations.reduce((function(decorationMap,_ref3){var _extends2,type=_ref3.type,data=_objectWithoutPropertiesLoose(_ref3,_excluded),currentDecoration=decorationMap[type]||{type:type},nextDecoration=_extends({type:type},data);return _extends({},decorationMap,((_extends2={})[type]=merge(currentDecoration,nextDecoration),_extends2))}),{});return Object.values(reducedDecorationsMap)},toLinkTarget=function(target){return void 0===target&&(target="SELF"),function(a,ab,bc,cd,de,ef,fg,gh,hi,ij,jk,kl,lm,mn,no,op,pq,qr,rs,st){switch(arguments.length){case 1:return a;case 2:return ab(a);case 3:return bc(ab(a));case 4:return cd(bc(ab(a)));case 5:return de(cd(bc(ab(a))));case 6:return ef(de(cd(bc(ab(a)))));case 7:return fg(ef(de(cd(bc(ab(a))))));case 8:return gh(fg(ef(de(cd(bc(ab(a)))))));case 9:return hi(gh(fg(ef(de(cd(bc(ab(a))))))));case 10:return ij(hi(gh(fg(ef(de(cd(bc(ab(a)))))))));case 11:return jk(ij(hi(gh(fg(ef(de(cd(bc(ab(a))))))))));case 12:return kl(jk(ij(hi(gh(fg(ef(de(cd(bc(ab(a)))))))))));case 13:return lm(kl(jk(ij(hi(gh(fg(ef(de(cd(bc(ab(a))))))))))));case 14:return mn(lm(kl(jk(ij(hi(gh(fg(ef(de(cd(bc(ab(a)))))))))))));case 15:return no(mn(lm(kl(jk(ij(hi(gh(fg(ef(de(cd(bc(ab(a))))))))))))));case 16:return op(no(mn(lm(kl(jk(ij(hi(gh(fg(ef(de(cd(bc(ab(a)))))))))))))));case 17:return pq(op(no(mn(lm(kl(jk(ij(hi(gh(fg(ef(de(cd(bc(ab(a))))))))))))))));case 18:return qr(pq(op(no(mn(lm(kl(jk(ij(hi(gh(fg(ef(de(cd(bc(ab(a)))))))))))))))));case 19:return rs(qr(pq(op(no(mn(lm(kl(jk(ij(hi(gh(fg(ef(de(cd(bc(ab(a))))))))))))))))));case 20:return st(rs(qr(pq(op(no(mn(lm(kl(jk(ij(hi(gh(fg(ef(de(cd(bc(ab(a)))))))))))))))))))}}(target,toUpperCase,(searchValue="_",replaceValue="",function(s){return s.replace(searchValue,replaceValue)}));var searchValue,replaceValue},createLink=function(_ref4){var iterable,url=_ref4.url,rel=_ref4.rel,target=_ref4.target,anchor=_ref4.anchor,relValues=(null==rel?void 0:rel.split(" ").filter((function(key){return["nofollow","sponsored","ugc"].includes(key)})).map((function(key){return[key,!0]})))||[];return{anchor:anchor,url:url,rel:relValues.length>0?(iterable=relValues,[].concat(iterable).reduce((function(obj,_ref){var key=_ref[0],val=_ref[1];return obj[key]=val,obj}),{})):void 0,target:toLinkTarget(target)}},parseLink=function(_ref5){var url=_ref5.url,rel=_ref5.rel,target=_ref5.target,anchor=_ref5.anchor,customData=_ref5.customData;return{anchor:anchor,url:url,rel:rel&&Object.entries(rel).flatMap((function(_ref6){var key=_ref6[0];return _ref6[1]?key:[]})).join(" "),target:target&&"_"+target.toLowerCase(),customData:customData}},createLinkDecoration=function(data){return createDecoration("LINK",{linkData:{link:createLink(data)}})},last=function(arr){return arr.length>0?arr[arr.length-1]:null},partitionBy=function(isSeparator,isPartition,Separator,Partition,addToPartition){return function(nodes){return nodes.reduce((function(partitions,node){if(isSeparator(node))partitions.push(Separator(node));else{var lastPartition=last(partitions);if(!lastPartition||!isPartition(lastPartition)){var partition=Partition(node);partitions.push(partition),lastPartition=last(partitions)}addToPartition(lastPartition,node)}return partitions}),[])}};export{createDecoration,createHeadingNode,createLink,createLinkDecoration,createNode,createParagraphNode,createTextNode,dataByNodeType,initializeMetadata,last,parseLink,partitionBy,reduceDecorations,toLinkTarget};
